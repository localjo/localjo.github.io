{"componentChunkName":"component---src-templates-project-tsx","path":"/projects/react-tater/","result":{"data":{"site":{"siteMetadata":{"title":"Jo Sprague - Software Engineer","description":"I work with JavaScript/TypeScript, React, Python and related tools and frameworks. I'm interested in working with teams that have a mission or product I'm passionate about.","author":{"name":"Jo Sprague","email":"web@josprague.com"}}},"markdownRemark":{"html":"<h2>Project History</h2>\n<p>This project started as my submission to a <a href=\"https://github.com/graphy-engineering/graphy-react-challenge\">coding challenge</a>. The challenge was to add the ability to add annotations to a demo React app. I decided to create a solution as a reusable React module that could be installed in any React project, and when I <a href=\"https://github.com/localjo/react-tater\">published my solution on GitHub</a>, it got over 200 stars overnight, so I decided to maintain it as an open source project.</p>\n<p>I named the library ‚ÄúTater‚Äù as a fun play on the words ‚Äúannotator‚Äù and ‚Äúpotato‚Äù. I had a lot of fun adding potatoes to web pages while testing it. ü•î There is <a href=\"https://josprague.com/react-tater-demo/\">a live demo of this library with an interactive tour</a> where you can add potatoes to the page or take a tour that explains how Tater works.</p>\n<h2>Technical Details</h2>\n<p>I made a number of technical choices while building this library that are worth explaining:</p>\n<ol>\n<li>\n<p><strong>Standalone React Library</strong></p>\n<p>Annotations are a good candidate for abstraction because the functionality\nisn‚Äôt dependent on the app it‚Äôs a part of, so I decided to abstract my\nsolution into <a href=\"https://github.com/localjo/react-tater/\">it‚Äôs own library</a>\nthat can be reused easily to add annotation functionality to any app.</p>\n</li>\n<li>\n<p><strong>Grid and Collision Detection</strong></p>\n<p>My solution for handling markers that overlap was to make sure that they‚Äôre\nnot overlapping in the first place. I did this by implementing <a href=\"https://github.com/localjo/react-tater/blob/master/src/position.js#L1-L9\">a collision detection algorithm</a>\nand <a href=\"https://github.com/localjo/react-tater/blob/master/src/position.js#L92-L111\">a placement algorithm</a>\nthat <a href=\"https://github.com/localjo/react-tater/blob/master/src/position.js#L34\">uses the Pythagorean Theorem</a>\nto reposition markers that collide into the nearest open space on a dynamic\ngrid. The grid is invisible but <a href=\"https://github.com/localjo/react-tater/blob/master/src/index.js#L38\">can be enabled in development</a>\nto debug the implementation:</p>\n<p><img src=\"./dynamic-placement-grid.png\" alt=\"Grid Placement Algorithm\"></p>\n</li>\n<li>\n<p><strong>Using Emoji for Markers</strong></p>\n<p>I chose to use emoji for the markers because they‚Äôre familiar, fun and\nfriendly. Browser support for emoji has improved and most modern browsers on\nmacOS, Windows, Android and iOS support them, but getting the implementation\nright was a challenge. I thought I could just type the emoji characters\ndirectly in my code, but Babel didn‚Äôt like that and threw errors in many\ncases:</p>\n<p><img src=\"./babel-potato-error.png\" alt=\"Babel Emoji Syntax Error\"></p>\n<p>My solution was to store <a href=\"https://github.com/localjo/react-tater/blob/master/src/emojis.js#L60\">emoji as an array of Unicode Code Points</a>\nand <a href=\"https://github.com/localjo/react-tater/blob/master/src/marker.js#L260\">decode them for display</a>.\nBut that wasn‚Äôt the complete solution, because I also ran into <a href=\"https://bugzilla.mozilla.org/show_bug.cgi?id=1608548\">problems with Firefox not displaying Keycap Digit emoji correctly</a>.\nTo solve that, I used CSS to <a href=\"https://github.com/localjo/react-tater/blob/master/src/marker.js#L20\">manually set an emoji font</a>\nfor the markers. This solution may need more testing on different browsers\nand operating systems.</p>\n</li>\n<li>\n<p><strong>Demo App Dependencies</strong></p>\n<p>Most of my focus was on building the Tater library. In this repo my goal was\njust to set up a nice looking page to demonstrate the library. I used <a href=\"https://material-ui.com/\"><code class=\"language-text\">material-ui</code></a>\nto set up some quick demo components without wasting too much time on them.\nI don‚Äôt consider this as a dependency of my solution, since my library works\nin any React app regardless of what UI library it might use. Tater itself\ndoesn‚Äôt use any <code class=\"language-text\">material-ui</code> components.</p>\n</li>\n<li>\n<p><strong>Unit Tests</strong></p>\n<p>I wrote some <a href=\"https://github.com/localjo/react-tater/blob/master/src/position.test.js\">unit tests for the positioning functions</a>\nin my library. This made it much easier to reason about the code for those\nfunctions since I could run the tests in watch mode while developing to\ncheck my logic. Running the tests in watch mode also gave me confidence\nthat I wasn‚Äôt breaking the underlying positioning functionality while\nmaking other changes to the library or refactoring code.</p>\n</li>\n</ol>\n<h2>Trade-offs and things left out</h2>\n<ol>\n<li>\n<p><strong>Responsive Layout and Percentage Coordinates</strong></p>\n<p>Early on in developing my solution, I decided that I wanted annotations to\nwork even if the annotated element‚Äôs size changed. This has the advantage of\nworking with responsive layouts. To achieve this, I decided to use percentage\nvalues to store the <code class=\"language-text\">x</code> and <code class=\"language-text\">y</code> coordinates instead of pixel values. The\ntrade-off is a little bit of loss of precision and while it works well for\nsimple rectangles, it doesn‚Äôt work quite as well with elements that don‚Äôt\nscale linearly or have children with changing ratios, as markers sometimes\nend up placed differently than a user might expect.</p>\n</li>\n<li>\n<p><strong>Browser/OS Compatibility</strong></p>\n<p>Given the amount of time and resources I dedicated to this, the number of\nbrowsers I was able to test in is somewhat limited. I tested on macOS\nCatalina and Windows 10 in the latest versions of Firefox and Chrome. More\nextensive testing could be done using BrowserStack to test different browsers\nand operating systems. While I considered responsive layouts, I didn‚Äôt test\nthis on mobile devices so its mobile functionality might be limited.</p>\n</li>\n<li>\n<p><strong>Dependencies and File Size</strong></p>\n<p>While I tried not to use unneeded dependencies, I didn‚Äôt measure my build‚Äôs\nfile size. Towards the end of the project, when publishing it, I noticed a\nwarning about the demo app‚Äôs bundle size of 275KiB exceeding the recommended\nlimit of 244KiB. While a lot of that file size comes from <code class=\"language-text\">material-ui</code> and\nnot from my solution, it would be good to consider the impacts of file size\non performance especially for a reusable library that might be installed\nin other apps.</p>\n</li>\n</ol>\n<h2>What I might change</h2>\n<p>If I were going to start over with this challenge, here‚Äôs what I might do differently:</p>\n<ol>\n<li>\n<p><strong>Use a Flux Data Store</strong></p>\n<p>I originally built my solution without Redux or any other library for\nmanaging state. This was partly because I wanted to avoid adding\ndependencies, and partly because I didn‚Äôt think the state I needed to manage\nwould be very complex. But I ran into a problem when I tested my solution\nwith a real user: tooltips in edit mode or the icon picker didn‚Äôt close\nautomatically when the user clicked outside of them, leading to a mess of\nediting tooltips open at the same time if the user wasn‚Äôt careful.</p>\n<p>Making the tooltips close when a user clicked outside of them proved to be a\nchallenge since each marker component manages it‚Äôs own state, and doesn‚Äôt\nreceive events that happen in siblings and parents. The first solution I\nthought of was to make each tooltip close whenever a <code class=\"language-text\">blur</code> event happened\n(the user clicked outside of the tooltip). I thought this would be\na quick and easy solution, but then to make sure that the <code class=\"language-text\">blur</code> event\nhappened, I had to add a <a href=\"https://github.com/localjo/react-tater/blob/master/src/marker.js#L263\">hidden textarea element</a>\ninside each tooltip, <a href=\"https://github.com/localjo/react-tater/blob/master/src/marker.js#L184-L205\">some timeouts</a>\nto make sure that clicks still got handled correctly and <a href=\"https://github.com/localjo/react-tater/blob/master/src/marker.js#L107-L114\">a state management trick</a>\nto handle blur events.</p>\n<p>A better solution would have been to hoist the state management for the\ntooltips to the parent and consider using <a href=\"https://facebook.github.io/flux/\">a Flux pattern</a>\nand maybe a library like Redux to manage the state of the entire annotator.\nA Flux pattern also would have helped me create a consistent internal API\nfor changing markers‚Äô emoji, text, position and pin state instead of writing\na different updater function for each of those changes.</p>\n</li>\n<li>\n<p><strong>Remove <code class=\"language-text\">styled-components</code></strong></p>\n<p>I started my solution using <code class=\"language-text\">styled-components</code> since it was contained in\nthe starter repo for the coding challenge. In the end, since there weren‚Äôt many components\nto be styled, I could have done the styling using React inline<code class=\"language-text\">style</code>\nattributes to avoid the extra dependency. The advantage would be that my\nsolution wouldn‚Äôt have any dependencies then, and would be more lightweight.\nThe downside would be slightly more complex syntax and more work to support\ncross-browser CSS, but the performance benefits might be worth it.</p>\n</li>\n<li>\n<p><strong>Better Emoji Selection</strong></p>\n<p>The <a href=\"https://github.com/localjo/react-tater/blob/master/src/marker.js#L248-L274\">emoji picker I built</a>\nonly allows for a selection from a limited set of emoji that I manually\nadded. In the future, I could develop a full-featured emoji picker that uses\nUnicode ranges to allow picking from all possible emoji and quickly\nsearching for emoji based on name.</p>\n</li>\n<li>\n<p><strong>Improved Support for Tours</strong></p>\n<p>I added a simple tour in the demo app, that shows the features of Tater\nitself. I think there is a lot of potential to expand that functionality\nand add support for building full-featured tours of an app. This could be\ndone by adding event handlers to the markers that progress through the tour\nwhen users perform certain actions. For example, opening the next tooltip in\na tour with something like; <code class=\"language-text\">onTooltipSave: ()=&gt;openTooltip(tooltipId)</code>.</p>\n</li>\n<li>\n<p><strong>Fix Memory Leak</strong></p>\n<p>When removing a marker from the page, there is a warning in the browser\nconsole about removing a React element without cleaning up all of it‚Äôs\nevent listeners, which could lead to a memory leak over time if a user\nadds and removes a lot of annotations without refreshing the page. I didn‚Äôt\nhave time to investigate the cause of this yet.</p>\n</li>\n<li>\n<p><strong>Add Test Coverage</strong></p>\n<p>I only added tests for the marker positioning functions, but there are more\nparts of the code that it would be worth adding tests to, specifically <a href=\"https://github.com/localjo/react-tater/blob/master/src/marker.js#L102-L138\">the\nmarker‚Äôs state reducer</a>.</p>\n</li>\n<li>\n<p><strong>Split Large Components into Smaller Parts</strong></p>\n<p>As my solution evolved, some components grew to be quite large. The code\norganization could be improved by splitting out different parts of existing\ncomponents into their own components. For example, there are three\n<code class=\"language-text\">&lt;Tooltip&gt;</code> components inside the <code class=\"language-text\">&lt;Mark&gt;</code> component that could be split\nout into their own files. Abstracting some of the reused components would\nhelp make things more testable and easier to reason about.</p>\n</li>\n</ol>","excerpt":"Project History This project started as my submission to a coding challenge. The challenge was to add the ability to add annotations to a‚Ä¶","fields":{"slug":"/projects/react-tater/"},"frontmatter":{"title":"react-tater","description":"A React plugin to add emoji markers and annotations to any element on a page. With algorithms for collision detection and finding nearest points.","featuredImage":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA/0lEQVR42o2PwUrDQBiE85j1EerJVFNS6gPkEKGGQHNIIDcPgm8QKMaUggfpzaM96EFF6W4SdtdsptmVhqRQ6MAH+7M/M/MbaCTKD6xWKRaLR6RpiizLkCQJ3jYbHFNd15BStqhZYahP8v2C6+klJpMpRiMT58MhBoMzPNzf4XW9xHweII5jBEEA3/cRRRGEEK1xV9qwkoDr3mA8tmDbNizrChemiWWWYv38hNnsFmEYNjsuHMeB53mglGpTxlgP4z9FHjkL4KJSL31WV0VRIM/zHirE2Fcui09wtkU3oPpjoORXLyoIIS2HZntaQ7p9byqTnqEUP+Dll27JOT+JHUE8tUxsoRhTAAAAAElFTkSuQmCC","aspectRatio":3.4774774774774775,"src":"/static/244cf9fd6a7517f05e2fa38624c5b76a/c05a1/react-tater-screenshot.png","srcSet":"/static/244cf9fd6a7517f05e2fa38624c5b76a/8787c/react-tater-screenshot.png 386w,\n/static/244cf9fd6a7517f05e2fa38624c5b76a/c0886/react-tater-screenshot.png 772w,\n/static/244cf9fd6a7517f05e2fa38624c5b76a/c05a1/react-tater-screenshot.png 782w","sizes":"(max-width: 782px) 100vw, 782px"}}},"socialImage":null,"thumbnail":{"childImageSharp":{"fixed":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAACMklEQVR42o2Ty2saYRTF/cckC/ER3QmC2cSC9a1pfcQYFVTECAYbiYv+A7aJ4EJx5UooRmmRQrMoKrhq64No0jQ2vj3NvTDWQBp64fB9883wm3Pn3BF1Oj8wmS3wezzHbDbDYrHAcrnkdVN0tlqtMJ/PcXd396Ta7TZE1ze/cNtrYfjtM969P8fJyRskk0mkUinW6ekp0uk0n8XjcWQyGfyrGDh8APbbX/Ahl4TJYoXdbofL5YLFYoHH44HD4YDb7cbOzg5kMhn0ej0mkwk7JreCc1Kr1YKo1+syfTC8ZUAgEEA4HIbX60UoFEIkEkEgGMDR0REMBgP29vb4E1ARRCjaN5tNiPr9Ph90ux12cnh4iEQiweD9/X1WMBjE7u4u5HI5OydXAkSA0tpoNP4Ce70et2e1WuHz+eB0OqFWq7lNlUqF7e1tSCQSvj+dTtkltUyi/RpIIKrJdIxSqYSzs3Nks1lWLpdDPp9HoVBAsVjktVKpMIQmQhBdr4FXg58Y3XzFx8pbHBwcwPTyBYwmE0wPMpvNHJLNZoPRaIRGo+FnyOEm9DHw6hr399/RbHyC87UTrldW+P1+/paUdiwW43C0Wi3EYjGDnwUKKY9GYw4icXzMoRCEwohGo/wCukdQcv0sUAhlMBjwwzqdjl1QmzQmCoUCUqkUSqUSW1tbPIfCH/VkKAKQhrVer6NcLuPi4gLVapVVq9XWewrk8vKSx2ZTwvg8AtJb/7c2E6b2BSgB/wDUF1LGVq9paQAAAABJRU5ErkJggg==","width":235,"height":157,"src":"/static/bdbf044ca03ec2028203bc64d3b62e5c/ca650/react-tater.png","srcSet":"/static/bdbf044ca03ec2028203bc64d3b62e5c/ca650/react-tater.png 1x"}}},"date":"May 3rd, 2010","category":"Open Source","technologies":["JavaScript","React","React Hooks","Jest","create-react-library","styled-components","Unicode Emoji","Collision Detection"],"links":[{"title":"Live Demo","url":"https://josprague.com/react-tater-demo/","color":"green"},{"title":"NPM Package","url":"https://www.npmjs.com/package/react-tater","color":"red"}]}}},"pageContext":{"slug":"/projects/react-tater/"}}}